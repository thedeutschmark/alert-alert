<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>deutschmark's Alert Creator</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <header>
        <div class="header-brand">
            <img src="/static/img/logo.png" alt="Logo" class="header-logo">
            <h1>AlertBox</h1>
        </div>
        <div class="header-actions">
            <div class="settings-dropdown">
                <button id="settings-btn" class="settings-btn" onclick="App.toggleSettings()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                </button>
                <div id="settings-menu" class="settings-menu hidden">
                    <div class="settings-section">
                        <label class="settings-label">Output Resolution</label>
                        <select id="setting-resolution" class="settings-select">
                            <option value="480">480p (480Ã—480)</option>
                            <option value="720" selected>720p (720Ã—720)</option>
                            <option value="1080">1080p (1080Ã—1080)</option>
                        </select>
                    </div>
                    <div class="settings-section">
                        <label class="settings-label">
                            End Buffer
                            <span class="tooltip-icon"
                                data-tooltip="Adds a freeze-frame at the end of the clip. Useful for stream alerts that need time to fade out.">?</span>
                        </label>
                        <select id="setting-buffer" class="settings-select">
                            <option value="0">None</option>
                            <option value="1">1 second</option>
                            <option value="2" selected>2 seconds</option>
                            <option value="3">3 seconds</option>
                            <option value="5">5 seconds</option>
                        </select>
                    </div>
                    <div class="settings-section">
                        <label class="settings-label">
                            Audio Normalization
                            <span class="tooltip-icon"
                                data-tooltip="Automatically adjusts audio levels to broadcast standard (-16 LUFS). Disable to preserve original audio levels.">?</span>
                        </label>
                        <div class="settings-toggle">
                            <input type="checkbox" id="setting-normalize-audio" checked>
                            <label for="setting-normalize-audio">Normalize audio levels</label>
                        </div>
                    </div>
                    <div class="settings-divider"></div>
                    <button class="settings-reset" onclick="App.resetSettings()">Reset to Defaults</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Dependency check banner -->
    <div id="dep-banner" class="banner hidden">
        <p id="dep-message"></p>
    </div>

    <main>
        <!-- Step 1: YouTube URL -->
        <section class="step" id="step-1">
            <h2><span class="step-num">1</span> Video Source</h2>
            <div class="step-content">
                <div class="input-row">
                    <input type="text" id="url-input" placeholder="Paste YouTube URL here..." spellcheck="false">
                    <button id="validate-btn" onclick="App.validateUrl()">Validate</button>
                </div>
                <div id="video-info" class="hidden">
                    <p class="info-label">Title: <span id="video-title"></span></p>
                    <p class="info-label">Duration: <span id="video-duration"></span></p>
                </div>
                <div id="step1-error" class="error-msg hidden"></div>
            </div>
        </section>

        <!-- Step 2: Timestamps -->
        <section class="step disabled" id="step-2">
            <h2><span class="step-num">2</span> Timestamps</h2>
            <div class="step-content">
                <div class="input-row">
                    <label>
                        Start
                        <input type="text" id="start-input" placeholder="0:00" class="time-input">
                    </label>
                    <label>
                        End
                        <input type="text" id="end-input" placeholder="0:15" class="time-input">
                    </label>
                    <span id="clip-duration" class="info-label"></span>
                </div>

                <!-- Separate Audio Source Toggle -->
                <div class="audio-source-toggle">
                    <label class="toggle-label">
                        <input type="checkbox" id="use-separate-audio">
                        <span class="toggle-text">Use separate audio source</span>
                    </label>
                </div>

                <!-- Separate Audio Source Section (hidden by default) -->
                <div id="audio-source-section" class="hidden audio-source-section">
                    <div class="audio-source-header">
                        <span class="audio-icon">ðŸŽµ</span>
                        <span>Audio Source</span>
                    </div>
                    <div class="input-row">
                        <input type="text" id="audio-url-input" placeholder="Paste YouTube URL for audio..."
                            spellcheck="false">
                        <button id="validate-audio-btn" onclick="App.validateAudioUrl()">Validate</button>
                    </div>
                    <div id="audio-video-info" class="hidden">
                        <p class="info-label">Title: <span id="audio-video-title"></span></p>
                        <p class="info-label">Duration: <span id="audio-video-duration"></span></p>
                    </div>
                    <div class="input-row">
                        <label>
                            Audio Start
                            <input type="text" id="audio-start-input" placeholder="0:00" class="time-input">
                        </label>
                        <label>
                            Audio End
                            <input type="text" id="audio-end-input" placeholder="0:15" class="time-input">
                        </label>
                        <span id="audio-clip-duration" class="info-label"></span>
                    </div>
                    <div id="audio-url-error" class="error-msg hidden"></div>
                </div>

                <div class="input-row" style="margin-top: 1rem;">
                    <button id="download-btn" onclick="App.downloadClip()">Download Clip</button>
                </div>
                <div id="download-status" class="hidden">
                    <span class="spinner"></span> <span id="download-status-text">Downloading...</span>
                </div>
                <div id="step2-error" class="error-msg hidden"></div>
            </div>
        </section>

        <!-- Step 3: Crop Preview -->
        <section class="step disabled" id="step-3">
            <h2><span class="step-num">3</span> Crop Preview</h2>
            <div class="step-content">
                <div id="crop-wrapper">
                    <div id="crop-container">
                        <img id="crop-image" draggable="false" alt="Video frame preview">
                        <div id="crop-overlay"></div>
                    </div>
                </div>
                <div class="crop-controls">
                    <div class="ratio-row">
                        <span class="slider-label">Ratio</span>
                        <div class="ratio-buttons" id="ratio-buttons">
                            <button class="ratio-btn active" data-ratio="1:1">1:1</button>
                            <button class="ratio-btn" data-ratio="16:9">16:9</button>
                            <button class="ratio-btn" data-ratio="9:16">9:16</button>
                            <button class="ratio-btn" data-ratio="4:3">4:3</button>
                        </div>
                    </div>
                    <div class="slider-row">
                        <span class="slider-label">Frame</span>
                        <label>
                            <input type="range" id="frame-scrubber" min="0" max="100" value="0" step="1">
                        </label>
                    </div>
                    <div class="slider-row">
                        <span class="slider-label">Zoom</span>
                        <label>
                            <input type="range" id="zoom-slider" min="10" max="100" value="100" step="1">
                        </label>
                        <span id="zoom-value" class="slider-value">100%</span>
                    </div>
                    <p id="crop-coords" class="info-label">Crop: X=0 Y=0</p>
                </div>
            </div>
        </section>

        <!-- Step 4: Process & Export -->
        <section class="step disabled" id="step-4">
            <h2><span class="step-num">4</span> Process &amp; Export</h2>
            <div class="step-content">
                <button id="process-btn" onclick="App.processVideo()">Process Video</button>
                <div id="progress-section" class="hidden">
                    <div class="progress-bar-bg">
                        <div id="progress-bar" class="progress-bar-fill" style="width: 0%"></div>
                    </div>
                    <p id="progress-text" class="info-label">Starting...</p>
                </div>
                <div id="download-section" class="hidden">
                    <button id="export-btn" class="export-btn" onclick="App.downloadResult()">Download Alert</button>
                </div>
                <div id="step4-error" class="error-msg hidden"></div>
            </div>
        </section>
    </main>

    <script src="/static/js/crop.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>