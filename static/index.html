<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alert! Alert!</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <header>
        <div class="header-brand">
            <h1 class="logo-text">Alert<span class="ascii-bang" id="ascii-bang-1">!</span> Alert<span class="ascii-bang" id="ascii-bang-2">!</span></h1>
        </div>
        <div class="header-actions">
            <div class="settings-dropdown">
                <button id="settings-btn" class="settings-btn" onclick="App.toggleSettings()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                </button>
                <div id="settings-menu" class="settings-menu hidden">
                    <div class="settings-section">
                        <label class="settings-label">Output Resolution</label>
                        <select id="setting-resolution" class="settings-select">
                            <option value="480">480p (480√ó480)</option>
                            <option value="720" selected>720p (720√ó720)</option>
                            <option value="1080">1080p (1080√ó1080)</option>
                        </select>
                    </div>
                    <div class="settings-section">
                        <label class="settings-label">
                            End Buffer
                            <span class="tooltip-icon"
                                data-tooltip="Adds a freeze-frame at the end of the clip. Useful for stream alerts that need time to fade out.">?</span>
                        </label>
                        <select id="setting-buffer" class="settings-select">
                            <option value="0">None</option>
                            <option value="1">1 second</option>
                            <option value="2" selected>2 seconds</option>
                            <option value="3">3 seconds</option>
                            <option value="5">5 seconds</option>
                        </select>
                    </div>
                    <div class="settings-section">
                        <label class="settings-label">
                            Audio Normalization
                            <span class="tooltip-icon"
                                data-tooltip="Automatically adjusts audio levels to broadcast standard (-16 LUFS). Disable to preserve original audio levels.">?</span>
                        </label>
                        <div class="settings-toggle">
                            <input type="checkbox" id="setting-normalize-audio" checked>
                            <label for="setting-normalize-audio">Normalize audio levels</label>
                        </div>
                    </div>
                    <div class="settings-divider"></div>

                    <div class="settings-section">
                        <label class="settings-label">Required Dependencies</label>
                        <div class="dep-links">
                            <a href="https://ffmpeg.org/download.html" target="_blank" class="dep-link">
                                <span class="dep-icon">üé¨</span>
                                <span class="dep-name">FFmpeg</span>
                                <span class="dep-status" id="dep-ffmpeg-status">checking...</span>
                            </a>
                            <a href="https://github.com/yt-dlp/yt-dlp/releases/latest" target="_blank" class="dep-link">
                                <span class="dep-icon">üì•</span>
                                <span class="dep-name">yt-dlp</span>
                                <span class="dep-status" id="dep-ytdlp-status">checking...</span>
                            </a>
                        </div>
                        <div class="settings-hint">
                            <p><strong>Missing something?</strong></p>
                            <ol style="margin-left: 1.2rem; margin-top: 0.5rem; text-align: left;">
                                <li><strong>FFmpeg:</strong> Open Command Prompt as Admin and run:
                                    <code>winget install Gyan.FFmpeg</code></li>
                                <li><strong>yt-dlp:</strong> Run: <code>pip install yt-dlp</code></li>
                                <li>Restart this app after installing.</li>
                            </ol>
                        </div>
                    </div>

                    <div class="settings-divider"></div>
                    <button class="settings-reset" onclick="App.resetSettings()">Reset to Defaults</button>
                    <div class="settings-divider"></div>
                    <button class="settings-quit" onclick="App.shutdownApp()"
                        style="width:100%;padding:0.75rem;margin-top:0.5rem;background:#ff4444;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:600;">Quit
                        App</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Dependency check banner -->
    <div id="dep-banner" class="banner hidden">
        <p id="dep-message"></p>
        <p id="dep-instructions" class="dep-instructions"></p>
    </div>

    <main class="main-layout">
        <!-- Floating Video Preview (appears after validation) -->
        <aside class="video-sidebar hidden" id="video-sidebar">
            <div class="video-preview-sticky">
                <div id="crop-container">
                    <video id="crop-video" loop muted playsinline></video>
                    <div id="crop-overlay" class="hidden"></div>
                </div>
                <div class="preview-controls">
                    <button id="preview-play-btn" class="control-btn">‚ñ∂ Play</button>
                    <button id="preview-mute-btn" class="control-btn">üîá Unmute</button>
                </div>
                <div class="volume-control">
                    <span class="volume-icon">üîä</span>
                    <input type="range" id="volume-slider" min="0" max="100" value="50" step="1">
                    <span id="volume-value" class="volume-value">50%</span>
                </div>
            </div>
        </aside>

        <!-- Workflow Steps -->
        <div class="workflow-steps">
            <!-- Step 1: Video Source -->
            <section class="step" id="step-1">
                <h2><span class="step-num">1</span> Video Source</h2>
                <div class="step-content">
                    <!-- Source type toggle -->
                    <div class="source-toggle">
                        <button class="source-btn active" id="source-url-btn" onclick="App.setSourceType('url')">URL</button>
                        <button class="source-btn" id="source-file-btn" onclick="App.setSourceType('file')">Local File</button>
                    </div>

                    <!-- URL input section -->
                    <div id="url-source-section">
                        <div class="input-row">
                            <input type="text" id="url-input" placeholder="Paste video URL (YouTube, Instagram, TikTok)..."
                                spellcheck="false">
                            <button id="validate-btn" onclick="App.validateUrl()">Load Video</button>
                        </div>
                    </div>

                    <!-- File input section -->
                    <div id="file-source-section" class="hidden">
                        <div class="file-upload-area" id="file-drop-zone">
                            <input type="file" id="local-video-input" accept="video/*" class="hidden">
                            <div class="file-upload-content">
                                <span class="file-upload-icon">üìÅ</span>
                                <p>Drag & drop video file here</p>
                                <p class="file-upload-hint">or <button type="button" class="link-btn" onclick="document.getElementById('local-video-input').click()">browse files</button></p>
                            </div>
                        </div>
                        <div id="selected-file-info" class="hidden">
                            <p class="info-label">File: <span id="selected-file-name"></span></p>
                        </div>
                    </div>

                    <div id="video-info" class="hidden">
                        <p class="info-label">Title: <span id="video-title"></span></p>
                        <p class="info-label">Duration: <span id="video-duration"></span></p>
                    </div>
                    <div id="download-status" class="hidden">
                        <span class="spinner"></span> <span id="download-status-text">Downloading...</span>
                    </div>
                    <div id="step1-error" class="error-msg hidden"></div>
                </div>
            </section>

            <!-- Step 2: Additional Options -->
            <section class="step disabled" id="step-2">
                <h2><span class="step-num">2</span> Options <span class="step-optional">(optional)</span></h2>
                <div class="step-content">
                    <!-- Separate Audio Source Toggle -->
                    <div class="audio-source-toggle">
                        <label class="toggle-label">
                            <input type="checkbox" id="use-separate-audio">
                            <span class="toggle-text">Use separate audio source</span>
                        </label>
                    </div>

                    <!-- Separate Audio Source Section (hidden by default) -->
                    <div id="audio-source-section" class="hidden audio-source-section">
                        <div class="audio-source-header">
                            <span class="audio-icon">üéµ</span>
                            <span>Audio Source</span>
                        </div>
                        <div class="input-row">
                            <input type="text" id="audio-url-input" placeholder="Paste video URL for audio..."
                                spellcheck="false">
                            <button id="validate-audio-btn" onclick="App.validateAudioUrl()">Validate</button>
                        </div>
                        <div id="audio-video-info" class="hidden">
                            <p class="info-label">Title: <span id="audio-video-title"></span></p>
                            <p class="info-label">Duration: <span id="audio-video-duration"></span></p>
                        </div>
                        <div class="input-row">
                            <label>
                                Audio Start
                                <input type="text" id="audio-start-input" placeholder="0:00" class="time-input">
                            </label>
                            <label>
                                Audio End
                                <input type="text" id="audio-end-input" placeholder="0:15" class="time-input">
                            </label>
                            <span id="audio-clip-duration" class="info-label"></span>
                        </div>
                        <div id="audio-url-error" class="error-msg hidden"></div>
                    </div>

                    <!-- Static Image Toggle -->
                    <div class="audio-source-toggle">
                        <label class="toggle-label">
                            <input type="checkbox" id="use-static-image">
                            <span class="toggle-text">Use static image with audio only</span>
                        </label>
                    </div>

                    <!-- Static Image Upload Section (hidden by default) -->
                    <div id="static-image-section" class="hidden audio-source-section">
                        <div class="audio-source-header">
                            <span class="audio-icon">üñºÔ∏è</span>
                            <span>Static Image</span>
                        </div>
                        <div class="input-row">
                            <input type="file" id="static-image-input" accept="image/*">
                        </div>
                        <div id="image-preview-container" class="hidden">
                            <img id="static-image-preview" alt="Preview">
                        </div>
                    </div>

                    <div id="step2-error" class="error-msg hidden"></div>
                </div>
            </section>

            <!-- Step 3: Crop & Trim -->
            <section class="step disabled" id="step-3">
                <h2><span class="step-num">3</span> Crop &amp; Trim</h2>
                <div class="step-content">
                    <div class="crop-controls">
                        <div class="ratio-row">
                            <span class="slider-label">Ratio</span>
                            <div class="ratio-buttons" id="ratio-buttons">
                                <button class="ratio-btn active" data-ratio="1:1">1:1</button>
                                <button class="ratio-btn" data-ratio="16:9">16:9</button>
                                <button class="ratio-btn" data-ratio="9:16">9:16</button>
                                <button class="ratio-btn" data-ratio="4:3">4:3</button>
                                <button class="ratio-btn" data-ratio="3:4">3:4</button>
                                <button class="ratio-btn" data-ratio="21:9">21:9</button>
                            </div>
                        </div>
                    </div>

                    <div class="slider-row">
                        <span class="slider-label">Zoom</span>
                        <label>
                            <input type="range" id="zoom-slider" min="10" max="100" value="100" step="1">
                        </label>
                        <span id="zoom-value" class="slider-value">100%</span>
                    </div>

                    <!-- Basic Trim Sliders -->
                    <div class="trim-controls">
                        <div class="trim-slider-row">
                            <label class="trim-label">
                                <span>Trim Start</span>
                                <input type="range" id="trim-start-slider" min="0" max="100" value="0" step="0.1">
                                <span id="trim-start-val" class="trim-val">0:00</span>
                            </label>
                        </div>
                        <div class="trim-slider-row">
                            <label class="trim-label">
                                <span>Trim End</span>
                                <input type="range" id="trim-end-slider" min="0" max="100" value="100" step="0.1">
                                <span id="trim-end-val" class="trim-val">0:00</span>
                            </label>
                        </div>
                        <div class="trim-duration-display">
                            <span id="trim-duration">Duration: 0:00</span>
                        </div>
                    </div>

                    <p id="crop-coords" class="info-label">Crop: X=0 Y=0</p>
                </div>
            </section>

            <!-- Step 4: Process & Export -->
            <section class="step disabled" id="step-4">
                <h2><span class="step-num">4</span> Process &amp; Export</h2>
                <div class="step-content">
                    <button id="process-btn" onclick="App.processVideo()">Process Video</button>
                    <div id="progress-section" class="hidden">
                        <div class="progress-bar-bg">
                            <div id="progress-bar" class="progress-bar-fill" style="width: 0%"></div>
                        </div>
                        <p id="progress-text" class="info-label">Starting...</p>
                    </div>
                    <div id="download-section" class="hidden">
                        <button id="export-btn" class="export-btn" onclick="App.downloadResult()">Download Alert</button>
                    </div>
                    <div id="step4-error" class="error-msg hidden"></div>
                </div>
            </section>
        </div>
    </main>

    <script src="/static/js/crop.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>